mysql

### 一致性非锁定读
- 当查询的数据有X锁时，会通过一致性非锁定读去读取undolog中的数据，避免一直阻塞
- rc模式下总会去读最新的一条记录(其他事务对该数据修改提交后又记录一条新的undolog日志)，所以这种模式又叫不可重复读
- rr模式下总会去读事务最开始的一条记录，所以这种模式又叫可重复读

### 一致性锁定读
- 当我们需要保证一致性时，可能会在查询中加上lock in share mode或者for update,这种情况下查询请求会阻塞，直到对应数据的X锁被释放。

### 锁
- 可重复读默认采用next-key-lock(间隙锁)解决幻读的情况，即使lock in share，其他线程也不能新增数据，但是单单在可重复读的级别下无法解决幻读（事务1先查询A，事务2修改A中的一个字段并提交，事务1修改A的另一个字段，事务1查询，发现读到了事务2修改的数据）
- 显示的用锁查询或者增删改数据时如果没有使用唯一索引，都会产生间隙锁
- 如果查询是加锁的字段使用了索引，则使用行锁，如果没有索引就是用表锁。（测试时发现加了辅助索引时用lock in share mode查询只锁定了这几条数据，并没有间隙锁）
